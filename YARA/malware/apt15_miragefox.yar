rule apt_miragefox : APT Windows RoyalAPT MirageFox {
	meta:
		author = "James E.C, Emerging Threats - Proofpoint"
		twitter = "@EcOzurie"
		mastodon = "https://infosec.exchange/@ozurie"
		description = "APT 15 MirageFox"
		hashes = "28d6a9a709b9ead84aece250889a1687c07e19f6993325ba5295410a478da30a"
		hashes = "97813e76564aa829a359c2d12c9c6b824c532de0fc15f43765cf6b106a32b9a5"
		hashes = "b7c1ae10f3037b7645541acb9f7421312fb1e164be964ee7acd6eb1299d6acb2"
		reference = "https://www.intezer.com/miragefox-apt15-resurfaces-with-new-tools-based-on-old-ones/"
		date = "15-06-2018"
	strings:
		$s1 = "%sos32__%d.ini"
		$s2 = "%susr32__%d.ini"
		$s3 = "%susrer__%d.ini"
		$s4 = "MirageFox_Server.dat"

		$x1 = "D:\\SvcSend.log"
		$x2 = "dll_wWinMain"
		$x3 = "Don't find cmd.exe,please check again or upload the program!"
		$x4 = "/search?gid=%s"
		$x5 = "User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:59.0) Gecko/20100101 Firefox/59.0"

		$crypt = { 33 c0 00 80 ?? ?? ?? ?? 40 3d ?? ?? 00 00 72 f2 c3 }
	condition:
		uint16be(0) == 0x4d5a and (2 of ($s*) and 2 of ($x*)) or (1 of ($s*) and $crypt)
}
