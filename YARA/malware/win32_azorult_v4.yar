rule win32_crimestealer_AZORult_v4 : Windows Crimeware AZORult {
	meta:
		author = "James E.C, Emerging Threats - Proofpoint"
		twitter = "@EcOzurie"
		mastodon = "https://infosec.exchange/@ozurie"
		description = "AZORult v4"
		hash = "a0d4306f52b31a922cf1944c883effa109151cd0bcde447bb03c007eddb68299"
		date = "26-10-2018"
		category = "malware"
		malfamily = "AZORultV4"
	strings:
		$steal1 = "Outlook" ascii fullword
		$steal2 = "wallet.dat" wide fullword
		$steal3 = "electrum.dat" wide fullword
		$steal4 = "Coins\\Electrum" wide fullword
		$steal5 = "Coins\\Ethereum" wide fullword
		$steal6 = "Coins\\Jaxx" wide
		$steal7 = "Coins\\MultiBitHD" wide fullword
		$steal8 = "Steam" wide fullword
		$steal9 = "Skype" wide fullword
		$steal10 = "Telegram" wide fullword
		$steal11 = "Software\\Martin Prikryl\\WinSCP 2\\Sessions\\" wide fullword
		$steal12 = "<password>" wide fullword
		$steal13 = "<account>" wide fullword

		$b64_1 = "UHJvY2Vzc29yTmFtZVN0cmluZw==" ascii fullword // ProcessorNameString
		$b64_2 = "SEFSRFdBUkVcREVTQ1JJUFRJT05cU3lzdGVtXENlbnRyYWxQcm9jZXNzb3JcMA==" ascii fullword // HARDWARE\DESCRIPTION\System\CentralProcessor\0
		$b64_3 = "UHJvY2VzczMyTmV4dFc=" ascii fullword // Process32NextW
		$b64_4 = "UHJvY2VzczMyRmlyc3RX" ascii fullword // Process32FirstW
		$b64_5 = "Q3JlYXRlVG9vbGhlbHAzMlNuYXBzaG90" ascii fullword // CreateToolhelp32Snapshot
		$b64_6 = "RGlzcGxheVZlcnNpb24=" ascii fullword // DisplayVersion
		$b64_7 = "U29mdHdhcmVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cVW5pbnN0YWxsXA==" ascii fullword // Software\Microsoft\Windows\CurrentVersion\Uninstall\
		$b64_8 = "RGlzcGxheU5hbWU=" ascii fullword // DisplayName

		$art1 = "PasswordsList.txt" ascii fullword
		$art2 = "scr.jpg" ascii fullword
		$art3 = "ip.txt" ascii fullword
		$art4 = "System.txt" ascii fullword

		$com1 = "/c %WINDIR%\\system32\\timeout.exe 3 & del \"" wide fullword
		$com2 = "SELECT DATETIME(" ascii

		$unk_c2 = "https://dotbit.me/a/" ascii fullword
	condition:
		(uint16be(0) == 0x4d5a and filesize < 300KB) and ((9 of ($steal*)) 
		or (1 of ($steal*) and (1 of ($b64_*))) 
		or (1 of ($steal*) and 1 of ($b64_*) and 1 of ($art*) and 1 of ($com*)) 
		or ($unk_c2))
}
