rule win32_darktrackRAT : Windows DarkTrack RAT {
	meta:
		author = "James E.C, Emerging Threats - Proofpoint"
		twitter = "@EcOzurie"
		mastodon = "https://infosec.exchange/@ozurie"
		description = "DarkTrack RAT Version 4, probably from a cracked builder."
		hashes = "b4a5b7e340ba136c4f35956225bd3e78de47ddd610a7095b5f13efbf766d635d"
		date = "11-01-2019"
		id = "20014" //20000-29999 Crimeware
		malfamily = "DarkTrackRAT4"
		category = "malware"
	strings:
		$dt1 = "I_AM_DT" ascii wide
		$dt2 = "DTracker" ascii wide
		$dt3 = "DTSERVER" ascii wide
		$dt4 = "Alien+" ascii wide // Alien is version 4, Colorful is rumoured to be version 5

		$steal1 = "\\Yandex\\YandexBrowser\\User Data\\Default\\Login Data" ascii wide
		$steal2 = "\\Comodo\\Dragon\\User Data\\Default\\Login Data" ascii wide
		$steal3 = ".encryptedUsername" ascii wide
		$steal4 = ".encryptedPassword" ascii wide

		$imp1 = "Toolhelp32ReadProcessMemory" ascii wide
		$imp2 = "CreateToolhelp32Snapshot" ascii wide
		$imp3 = "Process32Next" ascii wide

		$antivm1 = "VBoxService.exe" ascii wide
		$antivm2 = "SbieDll.dll" ascii wide
		$antivm3 = "dbghelp.dll" ascii wide
		$antisec1 = "AntiVirusProduct" ascii wide
		$antisec2 = "AntiSpywareProduct" ascii wide
		$antisec3 = "FirewallProduct" ascii wide

		$tools1 = "Sniffing started on interface" ascii wide
		$tools2 = "Port Number:" ascii wide
		$tools3 = "Status: OPEN" ascii wide
		$tools4 = "Status: CLOSE" ascii wide

		//$pdb = "C:\\Users\\gurkanarkas\\Desktop\\Dtback\\AlienEdition\\Server\\SuperObject.pas"
		//$cnc = "stainlessplc96.ddns.net"
	condition:
		uint16be(0) == 0x4d5a and all of ($dt*) and 2 of ($steal*) and all of ($imp*) and 4 of ($anti*) and 1 of ($tools*)
}
