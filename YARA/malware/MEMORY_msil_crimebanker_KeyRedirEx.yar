rule msil_crimebanker_KeyRedirEx_memory : Windows MSIL Banker Memory {
	meta:
		author = "[redact], ProofPoint"
		description = "MSIL KeyRedirEx Banking Trojan."
		hashes = "d95eaac6b838437ef502ba190da2fa82" // KeyRedirEx
		hashes = "ec33cc6cb625197587410840bce5983b" // BetaBot Dropper
		date = "29-10-2018"
		category = "malware"
		malfamily = "KeyRedirEx"
	strings:
		$mem_re = /REDIR;[^\r\n\x00]{1,100}\|-\|https?:\/\// // KeyRedirEx injects

		$s1 = "Starting redir timer func" wide // begins main inject loop
		$s2 = "Checking title:" wide // enumerates GetActiveWindowTitle -> array (str cmp later)
		$s3 = "Starting timer2 (requestInfo)" wide // retrieve instruction from C2 (see s7 and s8)
		$s4 = "{F6}" wide // select all in address bar of browser
		$s5 = "{ENTER}" wide // follows ctrl+v, paste phishing address -> enter
		$s6 = "vanderbilt" wide // mutex
		$s7 = "REDIR;" wide // pre-fixes each inject from C2
		$s8 = "EXIT;" wide // malware quit if received from C2
		
	condition:
		(4 of ($s*) or $mem_re)
}
