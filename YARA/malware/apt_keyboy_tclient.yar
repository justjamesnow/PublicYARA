rule apt_keyboy_tclient : APT Windows KeyBoy TClient {
	meta:
		author = "James E.C, Emerging Threats - Proofpoint"
		twitter = "@EcOzurie"
		mastodon = "https://infosec.exchange/@ozurie"
		description = "KeyBoy/TropicTrooper TClient Backdoor"
		hashes = "6e900e5b6dc4f21a004c5b5908c81f055db0d7026b3c5e105708586f85d3e334"
		reference = "https://blog.trendmicro.com/trendlabs-security-intelligence/tropic-trooper-new-strategy/"
		date = "16-03-2018"
		id = "10005"
	strings:
		$x1 = "Take Screen Error,May no user login!"
		$x2 = "GetScreenCmd from file:%s"
		$x3 = "#%sCmd shell is not running,or your cmd is error!"
		$x4 = "8. LoginPasswd:%s"
		$x5 = "Recv cmd:%d data:%s"
		$x6 = "showgodmoney1gz"
		$x7 = "I am going to %s......"

		$wmi1 = "SELECT * FROM Win32_NetworkAdapter WHERE (MACAddress IS NOT NULL) AND (NOT (PNPDeviceID LIKE 'ROOT%'))"
		$wmi2 = "SELECT * FROM Win32_Processor WHERE (ProcessorId IS NOT NULL)"
		$wmi3 = "SELECT * FROM Win32_OperatingSystem WHERE (InstallDate IS NOT NULL)"

		$s1 = ".zip"
		$s2 = ".arc"
		$s3 = ".lzh"
		$s4 = ".arj"
		$s5 = ".tgz"
		$s6 = "TClient.exe"
		$s7 = "ROOT\\CIMV2" wide
		$s8 = "MACAddress" wide
		$s9 = "http://myip.com.tw/"

		$pdb = "D:\\Work\\VS\\Horse\\TSSL\\TSSL_v0.3.1_20170722\\TClient\\x64\\Release\\TClient.pdb"

	condition:
		(uint16be(0) == 0x4d5a and filesize < 2MB) and (
		$pdb or (2 of ($x*) and 1 of ($wmi*)) or (1 of ($x*) and 1 of ($wmi*) and 4 of ($s*) or (4 of ($x*)))
		)
}
