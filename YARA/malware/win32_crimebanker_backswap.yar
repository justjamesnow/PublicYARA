rule win32_crimebanker_backswap : Crimeware Windows BackSwap {
	meta:
		author = "James E.C, Emerging Threats - Proofpoint"
		twitter = "@EcOzurie"
		mastodon = "https://infosec.exchange/@ozurie"
		description = "New banker family seen bypassing browser security mechanisms (new techniques)"
		hash = "f51336e862b891f78f2682505c3d38ea7de5b0673d6ef7a3b0907c0996887c22"
		hash = "2223a93521b261715767f00f0d1ae4e692bd593202be40f3508cb4fd5e21712b"
		hash = "16fe4de2235850a7d947e4517a667a9bfcca3aee17b5022b02c68cc584aa6548"
		reference = "https://www.welivesecurity.com/2018/05/25/backswap-malware-empty-bank-accounts/"
		date = "25-05-2018"
		category = "malware"
		malfamily = "BackSwap"
	strings:
		$x1 = "/web_33/includes/o.php" ascii
		$x2 = "MTNotPredefinedAccount.htm" ascii
		$x3 = "\\niko.log" ascii
		$x4 = "/C wmic Path win32_process Where \"ExecutablePath Like '%Startup\\%'\" Call Terminate" ascii
		$x5 = "/V:ON /C dir /S/B/A-D \"%APPDATA%\\Mozilla\\prefs.js\" > \"%TEMP%" ascii
		$x6 = "azi\" && SETLOCAL EnableDelayedExpansion && set /p v=<\"%TEMP%" ascii
		$x7 = "azi\" && echo ^user_pref(\"devtools.selfxss.count\", 100); >> \"!v!" ascii
		$x8 = "Chrome_WidgetWin_1" ascii
		$x9 = "/C wmic Path win32_process Where \"ExecutablePath Like '%Temp%'\" Call Terminate" ascii
		$x10 = "http://counter.yadro.ru/hit?rhttp://sexy.com/;uhttp://sexy.com/;h" ascii

		$inj1 = "pay_transfer_normal" ascii
		$inj2 = "24.pl/centrum24-web/ThirdPartyTransfer" ascii
		$inj3 = "mojeing/app/#home/start" ascii
		$inj4 = "https://*ipko.pl*transactions/transfers*" ascii
		$inj5 = "https://*mbank.pl*transfer*" ascii
		$inj6 = "https://*ingbank.pl*mojeing*transactions" ascii

		$g1 = "/C taskkill /f /t /im taskslist.exe" ascii
		$g2 = "/C taskkill /f /t /im sqlmon.exe" ascii
		$g3 = "^Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.8.4119.0 Safari/537.36" ascii
	condition:
		uint16be(0) == 0x4d5a and filesize < 1300KB and (1 of ($inj*) and 2 of ($x*)) or (1 of ($g*) and 1 of ($inj*))
}
