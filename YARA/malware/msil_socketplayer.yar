rule msil_rat_socketplayer : MSIL Windows RAT {
	meta:
		author = "James E.C, Emerging Threats - Proofpoint"
		twitter = "@EcOzurie"
		mastodon = "https://infosec.exchange/@ozurie"
		description = "Another .NET RAT but this uses websockets and reports to a Node JS C2."
		hash = "1cf67c25274473724a6cf614d45217edc16edbccebb3fa212f7b17e127362ea7"
		hash = "de38e74b2cd493d0f014fc6ca5d2834cea213778c2e056a7c84e9547fe275889"
		date = "04-04-2018"
		category = "malware"
		malfamily = "SocketPlayer"
	strings:
		$cmd1 = "gtscren" wide // requesting the bot takes a screenshot
		$cmd2 = "clcmd" wide
		$cmd3 = "fdir" wide // command to search a directory - lists dirs, files, creation times.  Dir name specified by the C2
		$cmd4 = "fdowl" wide // send file to C2, filename arg specified by C2
		$cmd5 = "fexc" wide // execute a program, program arg specified by C2
		$cmd6 = "fdel" wide // delete files and directories
		$cmd7 = "procs" wide // enumerate running processes
		$cmd8 = "prockill" wide // kill a running process, proc ID specified by C2
		$cmd9 = "upld" wide // upload file to C2
		$cmd10 = "kylgs" wide fullword // sets up keylog txt file, keylogger module doesn't exist
		$cmd11 = "destt" wide // remove Player persistence from registry
		$cmd12 = "fdrive" wide // command to enumerate drives (GetDrives)

		$x1 = "klsetup.txt" wide // keylog file
		$x2 = "asdasd" ascii fullword
		$x3 = "AvName" // function name for identifying AV on the infected system
		$x4 = "EnumerateFiles" // self explanatory
		$x5 = "sndfle" // send file to C2 function name
		$x6 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" wide

		$pdb = "C:\\Users\\DELL\\Desktop\\client\\asdasd.pdb" ascii
	condition:
		uint16be(0) == 0x4d5a and filesize < 3MB and $pdb or
		(8 of ($cmd*) or 3 of ($cmd*) and 3 of ($x*)
		)
}
