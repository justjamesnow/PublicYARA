rule msil_berbomthum : Windows MSIL {
	meta:
		author = "James E.C, ProofPoint"
		description = "Malicious memes, lol'd"
		reference = "blog.trendmicro.com/trendlabs-security-intelligence/cybercriminals-use-malicious-memes-that-communicate-with-malware/"
		hash = "003673cf045faf0141b0bd00eff13542a3a62125937ac27b80c9ffd27bb5c722"
		date = "17-12-2018"
		category = "malware"
		malfamily = "MalMemes"
	strings:
		$x1 = "<img src=\"(.*?):thumb\" width=\".*?\" height=\".*?\"/>" wide fullword
		$x2 = "https://pastebin.com/" wide
		$x3 = "https://twitter.com/"
		$s1 = "user-agent" wide fullword
		$s2 = "GetProcesses" ascii fullword
		$s3 = "getMacAddress" ascii fullword
		$s4 = "MemoryStream" ascii fullword
		$s5 = "System.Reflection" ascii fullword

	condition:
		(uint16be(0) == 0x4d5a and filesize < 100KB) and (4 of ($s*) and 1 of ($x*))
}
