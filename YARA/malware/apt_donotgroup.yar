rule apt_donotgroup_stealjobAPK : APT Android {
	meta:
		author = "James E.C, Emerging Threats - Proofpoint"
		twitter = "@EcOzurie"
		mastodon = "https://infosec.exchange/@ozurie"
		description = "Detects DonotGroup's StealJob APK based on class names in classes.dex."
		date = "20-04-2019"
		hash = "745fdbf7c78d971e0e82ee22861fc6279301aaae1683b7f5c06babc5bafd94ac"
		malfamily = "StealJob"
		category = "malware"
	strings:
		//$dex = { 64 65 78 }

		$s1 = "KeyLogs.java" ascii fullword
		$s2 = "KeyLogsControlInfo.java" ascii fullword
		$s3 = "KeyLogsDataProvider" ascii fullword
		$s4 = "KeyLogsDataSource" ascii fullword
		$s5 = "KeyLogsJob.java" ascii fullword
		$s6 = "/LiveRecordingSchedulingJob" ascii
		$s7 = "live_recordings/LiveRecordings;" ascii
	condition:
		uint32be(0) == 0x6465780A and filesize < 20MB and 4 of ($s*)
}

rule apt_donotgroup_ytyframework : APT DonotTeam Windows {
   meta:
		author = "James E.C, Emerging Threats - Proofpoint"
		twitter = "@EcOzurie"
		mastodon = "https://infosec.exchange/@ozurie"
		description = "Dropper for a modular malware framework with similarities to EHDevel"
		hashes = "1e0c1b97925e1ed90562d2c68971e038d8506b354dd6c1d2bcc252d2a48bc31c"
		reference = "arbornetworks.com/blog/asert/donot-team-leverages-new-modular-malware-framework-south-asia/"
		reference = "labs.bitdefender.com/2017/09/ehdevel-the-story-of-a-continuously-improving-advanced-threat-creation-toolkit/"
		date = "08-03-2018"
		id = "10002"
   strings:
		$x1 = "/football/download2/" ascii
		$x2 = "Caption: Xp>" wide

		$s1 = "SELECT Name FROM Win32_Processor" wide
		$s2 = "SELECT Caption FROM Win32_OperatingSystem" wide
		$s3 = "SELECT SerialNumber FROM Win32_DiskDrive" wide
		$s4 = "VM: Yes" wide
		$s5 = "VM: No" wide
		$s6 = "/q /noretstart" wide
		$s7 = "helpdll.dll" ascii
		$s8 = "boothelp.exe" ascii
		$s9 = "SbieDll.dll" wide

		$c2 = "5.135.199.0" ascii fullword
		$pdb = "C:\\Users\\803\\Desktop\\ytyboth\\yty 2.0\\Release\\Setup.pdb" ascii

   condition:
		(uint16be(0) == 0x4d5a and filesize < 500KB) and
		( $c2 or $pdb or 1 of ($x*) or 5 of ($s*) )
}

rule apt_donotgroup_ytyframework_mainmodule : APT DonotTeam Windows MSIL {
   meta: 
		author = "James E.C, Emerging Threats - Proofpoint"
		twitter = "@EcOzurie"
		mastodon = "https://infosec.exchange/@ozurie"
		description = "Main YTY Framework module (stealer), similarities to EHDevel"
		hashes = "2f3a7606df2e9b23c6da602311222052b85c540d052decbca3b3c83fc332ecd5"
		reference = "arbornetworks.com/blog/asert/donot-team-leverages-new-modular-malware-framework-south-asia/"
		reference = "labs.bitdefender.com/2017/09/ehdevel-the-story-of-a-continuously-improving-advanced-threat-creation-toolkit/"
		date = "08-03-2018"
		id = "10003"
   strings:
		$x1 = "/football/download/" wide

		$s1 = "boothelp.exe" ascii
		$s2 = "SbieDll.dll" wide
		$s3 = "dbghelp.dll" wide
		$s4 = "IsInSandbox" ascii
		$s5 = "YesNoMaybe" ascii
		$s6 = "getGoogle" ascii
		$s7 = "saveData" ascii
		$s8 = "saveLogs" ascii
		$s9 = "syssystemnew" ascii
		$s10 = "ytyinfo" ascii

		$pdb = "C:\\Users\\803\\Desktop\\ytyboth\\yty 2.0\\Release\\boothelp.pdb" ascii

   condition:
		(uint16be(0) == 0x4d5a and filesize < 500KB) and 
		( $pdb or $x1 and 4 of ($s*) or 6 of ($s*) )
}

rule apt_donotgroup_pdb_hunting : APT Windows DonotGroup {
   meta:
		author = "James E.C, Emerging Threats - Proofpoint"
		twitter = "@EcOzurie"
		mastodon = "https://infosec.exchange/@ozurie"
		description = "Detects a partial PDB path used by APT-C-35"
		date = "23-01-2019"
		id = "10022"
   strings:
		$s1 = "D:\\Soft\\DevelopedCode" ascii wide nocase
   condition:
		uint16be(0) == 0x4d5a and $s1
}
